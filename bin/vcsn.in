#! /bin/sh

: ${pyexecdir='@PYEXECDIR@'}
: ${VCSN_DATADIR='@DATADIR@'}
export VCSN_DATADIR

# _Append_ pyexecdir, not prepend, so that the user can still override
# this path via $PYTHONPATH.  Note in particular that the
# builddir-tests need to override $PYTHONPATH to use non-installed
# modules, which would them be overriden here and installed files
# would be used instead.
PYTHONPATH=$PYTHONPATH:$pyexecdir
export PYTHONPATH

help ()
{
  cat <<EOF
usage: vcsn COMMAND ARGS...

If COMMAND is "notebook", run Vcsn as an IPython Notebook.

If COMMAND is "run" (or "-e"), set up the environment to find
Vcsn, and run the ARGS...

If COMMAND is "efstcompile", "efstdecompile", "python", or "ipython",
run the corresponding program.

If COMMAND is one of the following commands, run the corresponding
TAF-Kit program:

  accessible are-equivalent are-isomorphic cat coaccessible complement
  complete compose concatenate constant-term conjunction derivation
  derived-term de-bruijn derivation divkbaseb term determinize
  difference divkbaseb double-ring eliminate-state enumerate evaluate
  expand infiltration is-ambiguous is-complete is-deterministic
  is-empty is-eps-acyclic is-normalized is-proper is-standard is-trim
  is-useless is-valid ladybird left-mult lift minimize power proper
  right-mult shortest shuffle split standard star star-normal-form sum
  thompson to-expression transpose trim u union universal

For more information, run:

  $ vcsn COMMAND -h

For instance:

  $ vcsn derived-term -C 'lal_char(abc), b' -e '(a+b+a)*' |
     vcsn determinize |
     vcsn minimize |
     vcsn to-expression
EOF
  exit 0
}

version ()
{
cat <<EOF
vcsn (@PACKAGE_STRING@)
<@PACKAGE_URL@>
EOF
  exit 0
}


if test $# = 0; then
  cat >&2 <<EOF
vcsn: missing file operand
Try 'vcsn --help' for more information.
EOF
  exit 1
fi

case $1 in
  ('--export') ;; # We are sourced to set up the environment.
  (-e|run) shift 1; exec "$@";;
  (-h|--help) help;;
  (-v|--version) version;;

  (efstcompile|efstdecompile|python*|ipython*) exec "$@";;

  (accessible|are-equivalent|are-isomorphic \
      |cat|chain|coaccessible|complement|complete \
      |compose|concatenate|conjunction \
      |de-bruijn \
      |derivation|derived-term|determinize \
      |difference|divkbaseb \
      |double-ring \
      |eliminate-state|enumerate|evaluate|expand \
      |infiltration \
      |is-ambiguous|is-complete|is-deterministic \
      |is-empty|is-eps-acyclic|is-normalized|is-proper \
      |is-standard|is-trim|is-useless|is-valid \
      |ladybird|left-mult|lift \
      |minimize \
      |power|proper \
      |random|right-mult \
      |shuffle|shortest|split|standard|star|star-normal-form|sum \
      |thompson \
      |to-expression \
      |transpose|trim \
      |u|union|universal)
     cmd=$(echo "$1" | sed -e 's/-/_/g')
     shift
     exec "vcsn-tafkit" "$cmd" "$@";;

  (*)
     prog="vcsn-$1"; shift; exec "$prog" "$@";;
esac

# Local Variables:
# mode: shell-script
# End:
