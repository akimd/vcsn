#!/bin/sh

set -ex
. $(dirname "$0")/common

## ----------- ##
## Configure.  ##
## ----------- ##

if $(older "$DIR_BUILD/Makefile" "$0"); then
  if test ! -d "$DIR_BUILD"; then
    test ! -e "$DIR_BUILD" \
      || fatal "DIR_BUILD is not a directory: $DIR_BUILD"
    mkdir -p "$DIR_BUILD" \
      || fatal "cannot mkdir $DIR_BUILD"
  fi
  cd "$DIR_BUILD"

  # If we are using ccache with clang, then we have spurious warnings:
  #
  # clang: warning: argument unused during compilation: '-I .'
  #
  # This can be addressed by -Qunused-arguments.
  case $CXX in
    (ccache*clang*)
      CXXFLAGS="$CXXFLAGS -Qunused-arguments"
      export CXXFLAGS
      ;;
  esac
  run "$DIR_SOURCE/configure"                   \
    --config-cache                              \
    --enable-dependency-tracking                \
    "$@"
fi
