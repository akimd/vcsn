#!/bin/sh

set -ex
. $(dirname "$0")/common

## ----------- ##
## Configure.  ##
## ----------- ##


# Compiler.
CONFIGUREFLAGS="                                \
  CC='ccache gcc-4.8'                           \
  CXX='ccache g++-4.8'"

if $(older "$DIR_BUILD/Makefile" "$0"); then
  if test ! -d "$DIR_BUILD"; then
    test ! -e "$DIR_BUILD" \
      || fatal "DIR_BUILD is not a directory: $DIR_BUILD"
    mkdir "$DIR_BUILD" \
      || fatal "cannot mkdir $DIR_BUILD"
  fi
  cd "$DIR_BUILD"
  run "$DIR_SOURCE/configure"                   \
    --config-cache                              \
    --prefix="$prefix"                          \
    --enable-dependency-tracking                \
    $CONFIGUREFLAGS                             \
  ||
  {
    sta=$?
    cat >&2 config.log
    exit $sta
  }
fi
