#! /bin/sh

# check AUTOMATON INPUT OUTPUT
# ----------------------------
check ()
{
  run 0 $3 -vcsn-evaluate $1 $2
}

cat > simple.dot <<EOF
digraph
{
  vcsn_context = "char_z_lal"
  vcsn_genset = "ab"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I1
    F2
  }
  1 -> 1 [label = "a + b"]
  1 -> 2 [label = "{2}a"]
  2 -> 2 [label = "a + b"]
  2 -> F2
  I1 -> 1
}
EOF

check simple.dot aabab 6
check simple.dot abab 4
check simple.dot aaaa 8
check simple.dot b 0
check simple.dot a 2

cat > initial-weight.dot <<EOF
digraph
{
  vcsn_context = "char_z_lal"
  vcsn_genset = "ab"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I1
    F2
  }
  1 -> 1 [label = "a + b"]
  1 -> 2 [label = "{2}a"]
  2 -> 2 [label = "a + b"]
  2 -> F2
  I1 -> 1 [label = "{2}"]
}
EOF

run 0 4  -vcsn-evaluate initial-weight.dot a
run 0 8  -vcsn-evaluate initial-weight.dot abab
run 0 12 -vcsn-evaluate initial-weight.dot aabab

cat > more-letters.dot <<EOF
digraph
{
  vcsn_context = "char_z_lal"
  vcsn_genset = "abc"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I1
    F2
  }
  1 -> 1 [label = "a + b"]
  1 -> 2 [label = "{2}a"]
  1 -> 3 [label = "c"]
  2 -> 2 [label = "a + b"]
  2 -> F2
  3 -> 1 [label = "a"]
  3 -> 2 [label = "a"]
  I1 -> 1 [label = "{2}"]
}
EOF

run 0 6 -vcsn-evaluate more-letters.dot caa

cat > prod.dot <<EOF
digraph
{
  vcsn_context = "char_z_lal"
  vcsn_genset = "abc"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I1
    F2
  }
  1 -> 1 [label = "a + b"]
  1 -> 2 [label = "{2}a"]
  1 -> 3 [label = "c"]
  2 -> 2 [label = "a + b"]
  2 -> F2
  3 -> 1 [label = "a"]
  3 -> 2 [label = "a"]
  I1 -> 1 [label = "{2}"]
}
EOF

check prod.dot aabab 12

cat > complex.dot <<EOF
digraph
{
  vcsn_context = "char_z_lal"
  vcsn_genset = "abc"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I1
    F2
  }
  1 -> 1 [label = "a + b"]
  1 -> 2 [label = "{2}a"]
  1 -> 3 [label = "c"]
  2 -> 2 [label = "a + b"]
  2 -> F2 [label = "{3}"]
  3 -> 1 [label = "a"]
  3 -> 2 [label = "a"]
  I1 -> 1 [label = "{2}"]
}
EOF

check complex.dot a 12
check complex.dot abab 24
check complex.dot aabab 36
