#! /bin/sh

# check AUTOMATON INPUT OUTPUT
# ----------------------------

check ()
{
  local expected=$1
  shift
  run 0 "$expected" -vcsn evaluate $@
}

cat >simple.daut <<EOF
context = [ab] -> Z
$ -> 0
0 -> 0 a, b
0 -> 1 <2>a
1 -> 1 a, b
1 -> $
EOF

check 4 -     -L aab <simple.daut
check 4 -A -  -L aab <simple.daut
check 4 -Af - -L aab <simple.daut
check 4 -f simple.daut -L aab


run 0 2 -/bin/sh -c "vcsn thompson -Ee -ab |
                     vcsn proper |
                     vcsn lweight -C '[...] -> Q' -W 2 -A - |
                     vcsn evaluate -L -e-ab"

run 1 - -"vcsn evaluate" </dev/null
sed -Ee 's,^.*/(lt-)?vcsn-tools:,vcsn-tools:,' err.eff >error-message
run 0 - -cat error-message <<EOF
vcsn-tools: error: evaluate: no matching algorithm
  candidates are:
      AUT:automaton L:word -> weight
      AUT:automaton P:polynomial -> weight
Try 'vcsn evaluate --help' for more information.
EOF
