#! /bin/sh

## ---------------------- ##
## (a+b)* x (b+c)* = b*.  ##
## ---------------------- ##

run 0 '' -vcsn-standard -C 'lal_char(ab)_b' -e '(a+b)*' -o ab.gv
run 0 '' -vcsn-standard -C 'lal_char(bc)_b' -e '(b+c)*' -o bc.gv
run 0 - -vcsn-product -f ab.gv bc.gv <<EOF
digraph
{
  vcsn_context = "lal_char(b)_b"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F0
    F1
  }
  { 0 1 }
  I0 -> 0
  0 -> F0
  0 -> 1 [label = "b"]
  1 -> F1
  1 -> 1 [label = "b"]
}
EOF

## ------------- ##
## ab x cd = 0.  ##
## ------------- ##

run 0 '' -vcsn-standard -C 'lal_char(ab)_b' -e 'ab' -o ab.gv
run 0 '' -vcsn-standard -C 'lal_char(cd)_b' -e 'cd' -o bc.gv
run 0 - -vcsn-product -f ab.gv bc.gv <<EOF
digraph
{
  vcsn_context = "lal_char_b"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
  }
  { 0 }
  I0 -> 0
}
EOF



## ---------------------- ##
## (a+b)* x (c+d)* = \e.  ##
## ---------------------- ##

run 0 '' -vcsn-standard -C 'lal_char(ab)_b' -e '(a+b)*' -o ab.gv
run 0 '' -vcsn-standard -C 'lal_char(cd)_b' -e '(c+d)*' -o bc.gv
run 0 - -vcsn-product -f ab.gv bc.gv <<EOF
digraph
{
  vcsn_context = "lal_char_b"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F0
  }
  { 0 }
  I0 -> 0
  0 -> F0
}
EOF



## ------------ ##
## lal_char_z.  ##
## ------------ ##

# <2>(a*b*a*)
cat >a.gv <<\EOF
digraph
{
  vcsn_context = "lal_char(abc)_z"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F0
    F1
    F2
  }
  { 0 1 2 }
  I0 -> 0 [label = "<2>"]
  0 -> F0
  0 -> 0 [label = "a"]
  0 -> 1 [label = "b"]
  0 -> 2 [label = "a"]
  1 -> F1
  1 -> 1 [label = "b"]
  1 -> 2 [label = "a"]
  2 -> F2
  2 -> 2 [label = "a"]
}
EOF

# (<3>(ab))*
cat >b.gv <<\EOF
digraph
{
  vcsn_context = "lal_char(abc)_z"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F0
  }
  { 0 1 }
  I0 -> 0 [label = "<3>"]
  0 -> F0
  0 -> 1 [label = "a"]
  1 -> 0 [label = "<3>b"]
}
EOF

cat >out.exp <<\EOF
digraph
{
  vcsn_context = "lal_char(abc)_z"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F0
    F3
  }
  { 0 1 2 3 }
  I0 -> 0 [label = "<6>"]
  0 -> F0
  0 -> 1 [label = "a"]
  0 -> 2 [label = "a"]
  1 -> 3 [label = "<3>b"]
  3 -> F3
  3 -> 2 [label = "a"]
}
EOF

run 0 out.exp -vcsn-product -f a.gv b.gv
