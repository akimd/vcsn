#! /bin/sh

# check_as EXPECT INPUT SUBST
# ---------------------------
# Perform sed SUBST on INPUT, and check that vcsn-is-proper gives EXPECT.
check_as ()
{
  local out
  out=$(echo "$2" | sed -e "$3")
  if test "$2" != "$out"; then
    sed -e "$3" < "$2" > "$out"
  fi
  case $1 in
    (true)  run 0 "$1" -vcsn-is-proper -A -f "$out";;
    (false) run 2 "$1" -vcsn-is-proper -A -f "$out";;
  esac
}

## ----------- ##
## is-proper.  ##
## ----------- ##

cat > lal_b.gv <<EOF
digraph
{
  vcsn_context = "lal_char(ab)_b"

  I0 -> 0
  0 -> 1 [label = "a"]
  0 -> 2 [label = "b"]
  1 -> 0 [label = "b"]
  2 -> 1 [label = "a"]
  2 -> 2 [label = "b"]
  1 -> F1
}
EOF

# Try for {lal, lan, law} x {b, z}.
for ls in lal lan law
do
  for ws in b z
  do
    check_as true lal_b.gv "s/lal/$ls/;s/_b/_$ws/"
  done
done


## ------------- ##
## ! is-proper.  ##
## ------------- ##

cat > lan_b.gv <<\EOF
digraph
{
  vcsn_context = "lan_char(ab)_b"
  I0 -> 0
  0 -> 1 [label = "\\e, a"]
  1 -> F1
}
EOF

# Try for {lan, law} x {b, z}.
for ls in lan law
do
  for ws in b z
  do
    check_as false lan_b.gv "s/lan/$ls/;s/_b/_$ws/"
  done
done
