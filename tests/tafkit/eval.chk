#! /bin/sh

# check AUTOMATON INPUT OUTPUT
# ----------------------------
check ()
{
  run 0 "$3" -vcsn-evaluate -f "$1" "$2"
}

cat > simple.dot <<EOF
digraph
{
  vcsn_context = "lal_char(ab)_z"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F1
  }
  0 -> 0 [label = "a, b"]
  0 -> 1 [label = "{2}a"]
  1 -> 1 [label = "a, b"]
  1 -> F1
  I0 -> 0
}
EOF

check simple.dot aabab 6
check simple.dot abab 4
check simple.dot aaaa 8
check simple.dot b 0
check simple.dot a 2

cat > initial-weight.dot <<EOF
digraph
{
  vcsn_context = "lal_char(ab)_z"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F1
  }
  0 -> 0 [label = "a, b"]
  0 -> 1 [label = "{2}a"]
  1 -> 1 [label = "a, b"]
  1 -> F1
  I0 -> 0 [label = "{2}"]
}
EOF

run 0 4  -vcsn-evaluate -f initial-weight.dot a
run 0 8  -vcsn-evaluate -f initial-weight.dot abab
run 0 12 -vcsn-evaluate -f initial-weight.dot aabab

cat > more-letters.dot <<EOF
digraph
{
  vcsn_context = "lal_char(abc)_z"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F1
  }
  0 -> 0 [label = "a, b"]
  0 -> 1 [label = "{2}a"]
  0 -> 2 [label = "c"]
  1 -> 1 [label = "a, b"]
  1 -> F1
  2 -> 0 [label = "a"]
  2 -> 1 [label = "a"]
  I0 -> 0 [label = "{2}"]
}
EOF

run 0 6 -vcsn-evaluate -f more-letters.dot caa

cat > prod.dot <<EOF
digraph
{
  vcsn_context = "lal_char(abc)_z"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F1
  }
  0 -> 0 [label = "a, b"]
  0 -> 1 [label = "{2}a"]
  0 -> 2 [label = "c"]
  1 -> 1 [label = "a, b"]
  1 -> F1
  2 -> 0 [label = "a"]
  2 -> 1 [label = "a"]
  I0 -> 0 [label = "{2}"]
}
EOF

check prod.dot aabab 12

cat > complex.dot <<EOF
digraph
{
  vcsn_context = "lal_char(abc)_z"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F1
  }
  0 -> 0 [label = "a, b"]
  0 -> 1 [label = "{2}a"]
  0 -> 2 [label = "c"]
  1 -> 1 [label = "a, b"]
  1 -> F1 [label = "{3}"]
  2 -> 0 [label = "a"]
  2 -> 1 [label = "a"]
  I0 -> 0 [label = "{2}"]
}
EOF

check complex.dot a 12
check complex.dot abab 24
check complex.dot aabab 36
