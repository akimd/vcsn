#! /bin/sh

# check AUTOMATON INPUT OUTPUT
# ----------------------------
check ()
{
  run 0 "$3" -vcsn evaluate -f "$1" "$2"
}

## ------------ ##
## lal_char_z.  ##
## ------------ ##

cat > simple.gv <<\EOF
digraph
{
  vcsn_context = "lal_char(ab)_z"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F1
  }
  0 -> 0 [label = "a, b"]
  0 -> 1 [label = "<2>a"]
  1 -> 1 [label = "a, b"]
  1 -> F1
  I0 -> 0
}
EOF

check simple.gv aabab 6
check simple.gv abab 4
check simple.gv aaaa 8
check simple.gv b 0
check simple.gv a 2

cat > initial-weight.gv <<\EOF
digraph
{
  vcsn_context = "lal_char(ab)_z"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F1
  }
  0 -> 0 [label = "a, b"]
  0 -> 1 [label = "<2>a"]
  1 -> 1 [label = "a, b"]
  1 -> F1
  I0 -> 0 [label = "<2>"]
}
EOF

run 0 4  -vcsn evaluate -f initial-weight.gv a
run 0 8  -vcsn evaluate -f initial-weight.gv abab
run 0 12 -vcsn evaluate -f initial-weight.gv aabab

cat > more-letters.gv <<\EOF
digraph
{
  vcsn_context = "lal_char(abc)_z"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F1
  }
  0 -> 0 [label = "a, b"]
  0 -> 1 [label = "<2>a"]
  0 -> 2 [label = "c"]
  1 -> 1 [label = "a, b"]
  1 -> F1
  2 -> 0 [label = "a"]
  2 -> 1 [label = "a"]
  I0 -> 0 [label = "<2>"]
}
EOF

run 0 6 -vcsn evaluate -f more-letters.gv caa

cat > prod.gv <<\EOF
digraph
{
  vcsn_context = "lal_char(abc)_z"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F1
  }
  0 -> 0 [label = "a, b"]
  0 -> 1 [label = "<2>a"]
  0 -> 2 [label = "c"]
  1 -> 1 [label = "a, b"]
  1 -> F1
  2 -> 0 [label = "a"]
  2 -> 1 [label = "a"]
  I0 -> 0 [label = "<2>"]
}
EOF

check prod.gv aabab 12

cat > complex.gv <<\EOF
digraph
{
  vcsn_context = "lal_char(abc)_z"
  rankdir = LR
  node [shape = circle]
  {
    node [style = invis, shape = none, label = "", width = 0, height = 0]
    I0
    F1
  }
  0 -> 0 [label = "a, b"]
  0 -> 1 [label = "<2>a"]
  0 -> 2 [label = "c"]
  1 -> 1 [label = "a, b"]
  1 -> F1 [label = "<3>"]
  2 -> 0 [label = "a"]
  2 -> 1 [label = "a"]
  I0 -> 0 [label = "<2>"]
}
EOF

check complex.gv a 12
check complex.gv abab 24
check complex.gv aabab 36


## --------------- ##
## lal_char_zmin.  ##
## --------------- ##

run 0 '' -vcsn standard -e '(?@lal_char(abc)_zmin)a' -o a.gv

check a.gv '' oo
check a.gv 'a' 0
check a.gv 'aa' oo
check a.gv 'b' oo
check $top_srcdir/share/vcsn/lal_char_zmin/minab.gv '' 0
check $top_srcdir/share/vcsn/lal_char_zmin/minab.gv 'b' 0
check $top_srcdir/share/vcsn/lal_char_zmin/minab.gv 'a' 0
check $top_srcdir/share/vcsn/lal_char_zmin/minab.gv 'ab' 1
check $top_srcdir/share/vcsn/lal_char_zmin/minab.gv 'abababbbb' 3

check $top_srcdir/share/vcsn/lal_char_zmin/minblocka.gv '' oo
check $top_srcdir/share/vcsn/lal_char_zmin/minblocka.gv 'b' oo
check $top_srcdir/share/vcsn/lal_char_zmin/minblocka.gv 'a' oo
check $top_srcdir/share/vcsn/lal_char_zmin/minblocka.gv 'ab' oo
check $top_srcdir/share/vcsn/lal_char_zmin/minblocka.gv 'abababbbb' 0
check $top_srcdir/share/vcsn/lal_char_zmin/minblocka.gv 'aabaaba' 2

check $top_srcdir/share/vcsn/lal_char_zmin/slowgrow.gv '' oo
check $top_srcdir/share/vcsn/lal_char_zmin/slowgrow.gv 'b' oo
check $top_srcdir/share/vcsn/lal_char_zmin/slowgrow.gv 'a' oo
check $top_srcdir/share/vcsn/lal_char_zmin/slowgrow.gv 'ab' oo
check $top_srcdir/share/vcsn/lal_char_zmin/slowgrow.gv 'abababb' 0
check $top_srcdir/share/vcsn/lal_char_zmin/slowgrow.gv 'abbaaa' 0
check $top_srcdir/share/vcsn/lal_char_zmin/slowgrow.gv 'abbababa' 1
check $top_srcdir/share/vcsn/lal_char_zmin/slowgrow.gv 'baaaab' 4
