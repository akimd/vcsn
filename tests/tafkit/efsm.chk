#! /bin/sh

# check IN < OUT
# --------------
# Check the conversion from Dot to FSM.
check ()
{
  cat >out.efsm
  cp out.efsm out.exp
  run 0 out.exp -vcsn-cat -O efsm -Af "$1"
  # Check that efstcompile is happy with it, as an acceptor.
  run 0 ignore -efstcompile out.efsm
}

## --------------------- ##
## A Boolean automaton.  ##
## --------------------- ##

check $top_srcdir/share/vcsn/lal_char_b/a1.gv <<EOF
#! /bin/sh

cat >isymbols.txt <<\EOFSM
\e	0
a	1
b	2
EOFSM

cat >transitions.fsm <<\EOFSM
0	2	\e
2	2	a
2	2	b
2	3	a
3	4	b
4	4	a
4	4	b
4
EOFSM

fstcompile --acceptor --keep_isymbols --isymbols=isymbols.txt transitions.fsm
EOF

## --------------- ##
## A Z automaton.  ##
## --------------- ##

check $top_srcdir/share/vcsn/lal_char_z/binary.gv <<EOF
#! /bin/sh

cat >isymbols.txt <<\EOFSM
\e	0
0	1
1	2
EOFSM

cat >transitions.fsm <<\EOFSM
0	2	\e
2	2	0
2	2	1
2	3	1
3
3	3	0	2
3	3	1	2
EOFSM

fstcompile --acceptor --keep_isymbols --isymbols=isymbols.txt transitions.fsm
EOF
