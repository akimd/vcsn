#! /bin/sh

# check INPUT OUTPUT
# ------------------
check ()
{
  run 0 "$2" -vcsn-star-normal-form -E -C "$ctx" -e "$1"
  # Idempotent.
  run 0 "$2" -vcsn-star-normal-form -E -C "$ctx" -e "$2"
}

# fail INPUT
# ----------
fail ()
{
  run 1 '' -vcsn-star-normal-form -E -C "$ctx" -e "$1"
  # If it does not work, it's because anyway the ratexp is invalid.
  run 2 'false' -vcsn-is-valid -E -C "$ctx" -e "$1"
}

ctx='lal_char(ab)_b'
check a a
check 'a*' 'a*'
check '\e*' '\e'
check '(a*b*)*' '(a+b)*'
check '(a*b*)**' '(a+b)*'

ctx='lal_char(ab)_z'
fail '\e*'
fail 'a**'
check '(a+b)*' '(a+b)*'

ctx='lal_char(ab)_q'
fail '\e*'
check '(<1/2>\e+a)*' '<2>a*'
fail '(<1/2>\e+a)**'
check '(<1/6>a*<1/3>b*)*' '<18/17>(<1/6>a+<1/3>b)*'
check '(<1/6>a*+<1/3>b*)*' '<2>(<1/6>a+<1/3>b)*'

ctx='lal_char(ab)_ratexpset<lal_char(wxyz)_z>'
check '<w>(<x>\e+<y>a)*<z>' '<w.x*>(<y>a)*<z>'
check '<w>(<x>\e+<y>a)*<z>*' '<(w.x*.z)*>(<w.y.z>a)*'
