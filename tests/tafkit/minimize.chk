#! /bin/sh

# check ALGO IN OUT
# -----------------
check()
{
  run 0 -f "$3" -vcsn minimize -f "$2" "$1"
}

# xfail ALGO IN
# -------------
xfail()
{
  run 134 '' -vcsn minimize -f "$2" "$1"
}

## Simple minimization test.  The example comes from the "Th√©orie des
## langages" course notes by Akim Demaille.  Automaton 4.23 at page 59,
## as of revision a0761d6.
check moore     "$medir/redundant.gv" "$medir/redundant.exp.gv"
check signature "$medir/redundant.gv" "$medir/redundant.exp.gv"

## An automaton equal to redundant.exp, with one transition removed.
check moore     "$medir/incomplete-non-trim.gv" "$medir/incomplete-non-trim.moore.gv"
xfail signature "$medir/incomplete-non-trim.gv"

## An automaton equal to redundant.exp, with no initial states.  It
## must be minimized into an empty automaton.
check moore     "$medir/no-initial-states.gv" "$medir/no-initial-states.moore.gv"
xfail signature "$medir/no-initial-states.gv"

## An automaton equal to redundant.exp, with no final states.  It must
## be minimized into an empty automaton.
check moore     "$medir/no-final-states.gv" "$medir/no-final-states.moore.gv"
xfail signature "$medir/no-final-states.gv"

## Minimize an intricate automaton into a linear one.
run 0 '' -vcsn standard -C 'lal_char(abcdefghijk)_b' \
  -e '(a+b+c+d+e+f+g+h+i+j+k){10}' -o intricate.gv
check moore     intricate.gv "$medir/intricate.exp.gv"
check signature intricate.gv "$medir/intricate.exp.gv"

## Compute the quotient of a non-deterministic automaton, in this case
## yielding the minimal deterministic solution.
run 0 '' -vcsn standard -C 'lal_char(a)_b' \
  -e 'a{2}*+a{2}*' -o small-nfa.gv
xfail moore     small-nfa.gv
check signature small-nfa.gv "$medir/small-nfa.exp.gv"
