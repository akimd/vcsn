#! /bin/sh

## ----------- ##
## enumerate.  ##
## ----------- ##

## check_enumerate EXP MAX WORD...
## -------------------------------
## Check that EXP accepts WORD... has shortest words up to size MAX.
check_enumerate ()
{
  exp=$1
  max=$2
  shift 2
  for i
  do
    echo "$i"
  done >out.exp
  run 0 out.exp -vcsn-enumerate -Ee "$exp" "$max"
}


## check_shortest EXP WORD
## -----------------------
## Check that EXP accepts WORD has shortest word, or throws if empty.
check_shortest ()
{
  exp=$1
  expout=$(sed 1q out.exp)
  case $expout in
    ('') run 1 "$expout" -vcsn-shortest -Ee "$exp";;
    (*)  run 0 "$expout" -vcsn-shortest -Ee "$exp";;
  esac
}

## check EXP MAX WORD...
## ---------------------
## Check that EXP accepts WORD... has shortest words up to size MAX,
## and its shortest word is WORD.  Use only if MAX is long enough
## for WORD.
check ()
{
  exp=$1
  shift
  check_enumerate "$exp" "$@"
  expout=$(sed 1q out.exp)
  check_shortest "$exp"
}


check '\z' 3
check '\e' 3 '\e'
check '(a+b)' 2 'a' 'b'
check '(a+b)*' 2 '\e' 'a' 'b' aa ab ba bb

check_enumerate 'ababab' 2
check 'ababab' 10 ababab

check '(?@lal_char(01)_z)(0+1)*1(<2>0+<2>1)*' 3 \
      1 \
      01 '<2>10' '<3>11' \
      001 '<2>010' '<3>011' '<4>100' '<5>101' '<6>110' '<7>111'

check '(?@lal_char(a)_z)a+<-1>a' 2
