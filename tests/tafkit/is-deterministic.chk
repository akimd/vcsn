#! /bin/sh

# check_lal EXPECT < LAL.DOT
# --------------------------
# Check that is-deterministic(INPUT) = EXPECT in lal, lan, and law.
check_lal ()
{
  local status
  case $1 in
    (true)  status=0;;
    (false) status=2;;
  esac
  cat >lal.gv
  run $status "$1" -vcsn-is-deterministic -A -f lal.gv
  sed -e 's/lal/lan/' lal.gv > lan.gv
  run $status "$1" -vcsn-is-deterministic -A -f lan.gv
  sed -e 's/lal/law/' lal.gv > law.gv
  run $status "$1" -vcsn-is-deterministic -A -f law.gv
}

## ------------ ##
## lal_char_b.  ##
## ------------ ##

check_lal "true" <<EOF
digraph
{
  vcsn_context = "lal_char(ab)_b"

  I0 -> 0
  0 -> 1 [label = "a"]
  0 -> 2 [label = "b"]
  1 -> 0 [label = "b"]
  2 -> 1 [label = "a"]
  2 -> 2 [label = "b"]
  1 -> F1
}
EOF


check_lal "false" <<EOF
digraph
{
  vcsn_context = "lal_char(abc)_b"

  I0 -> 0
  0 -> 1 [label = "a"]
  0 -> 0 [label = "a"]
  1 -> 1 [label = "b"]
  1 -> 2 [label = "b"]
  2 -> 2 [label = "c"]
  2 -> F2
}
EOF


check_lal "true" <<EOF
digraph
{
  vcsn_context = "lal_char(a)_b"

  I0 -> 0
  0 -> 1 [label = "a"]
  1 -> 2 [label = "a"]
  2 -> 3 [label = "a"]
  3 -> 4 [label = "a"]
  4 -> 5 [label = "a"]
  5 -> F5
}
EOF


check_lal "true" <<EOF
digraph
{
  vcsn_context = "lal_char(ab)_b"

  I0 -> 0
  0 -> 1 [label = "a"]
  0 -> 2 [label = "b"]
  1 -> 3 [label = "a"]
  2 -> 3 [label = "b"]
  3 -> 3 [label = "a"]
  3 -> 3 [label = "b"]
  3 -> F3
}
EOF


check_lal "false" <<EOF
digraph
{
  vcsn_context = "lal_char(abc)_b"

  I0 -> 0
  0 -> 1 [label = "a"]
  1 -> 1 [label = "b"]
  1 -> 2 [label = "c"]
  0 -> 3 [label = "c"]
  3 -> 3 [label = "c"]
  3 -> 2 [label = "c"]
  2 -> 4 [label = "a"]
  4 -> F4
}
EOF


check_lal "true" <<EOF
digraph
{
  vcsn_context = "lal_char(ab)_b"

  I0 -> 0
  0 -> 1 [label = "b"]
  0 -> 2 [label = "a"]
  1 -> 2 [label = "a"]
  2 -> F2
}
EOF


check_lal "false" <<EOF
digraph
{
  vcsn_context = "lal_char(a)_b"

  I0 -> 0
  I1 -> 1
  0 -> 2 [label = "a"]
  1 -> 2 [label = "a"]
  2 -> F2
}
EOF
