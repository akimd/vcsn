\subsection{Automaton $\mathcal{D}_{2}$ (bis)}
\label{automatonD2rw}
\begin{figure}[h]
  \begin{minipage}[c]{.60\textwidth}
    Ref: ETA p. 699  Fig. V.1.4

    The transducer~$\mathcal{D}_{2}$ that realises the Fibonacci reduction
    $a\, b\, b \rightarrow b\, a\, a$, viewed as an automaton on
    $\left\{ a,b \right\}*$ with multiplicities in $\mathrm{Rat}\left\{ a,b \right\}*$.
  \end{minipage}
  \begin{minipage}[c]{.40\textwidth}

  \VCDraw{%
\begin{VCPicture}{(3,-1.4)(13,2)}
% param etats
\SmallState
% etats
% \State{(0,0)}{A}{p}
\State{(5,0)}{B} %{d}
\State{(9,0)}{C} %{q}
\State{(13,0)}{D} %{r}
%
\ChgEdgeLabelScale{0.9}
\Initial{B}
\Final[s]{B}
\FinalR[1]{s}{C}{\IOL{1}{a}}
\FinalL[1]{s}{D}{\IOL{1}{ab}}
% transitions [.75]
\EdgeL{B}{C}{\IOL{a}{1}}
\ArcR{C}{D}{\IOL{b}{1}}
\ArcR{D}{C}{\IOL{a}{ab}}
%
\LoopN[.5]{B}{\IOL{b}{b}}
\LoopN[.5]{C}{\IOL{a}{a}}
\VCurveR[.2]{ncurv=1.2,angleA=90,angleB=40}%
    {D}{C}{\IOL{b}{ba}}
%
\end{VCPicture}
}

  \end{minipage}
\end{figure}

{\footnotesize
\begin{listing}[5]{1}
<fsmxml  xmlns   = "http://vaucanson-project.org"
         version = "1.0" >

<automaton name = "d2-rw" >
  <valueType>
    <semiring  type       = 'series'
               zeroSymbol     = "0"
               identitySymbol = "1" >
      <semiring  type       = 'numerical'
                 set        = 'B'
                 operations = 'classical' />
      <monoid    type       = 'free'
                 genSort    = 'simple'
                 genKind    = 'letter'
                 genDescript = 'enum' >
        <monGen value="a"/>
        <monGen value="b"/>
      </monoid>
    </semiring>
    <monoid    type       = 'free'
               genSort    = 'simple'
               genKind    = 'letter'
               genDescript = 'enum'>
      <monGen value="a"/>
      <monGen value="b"/>
    </monoid>
  </valueType>

  <automatonStruct>
    <states>
      <state  id="0"  name = "1" />
      <state  id="1"  name = "a" />
      <state  id="2"  name = "ab" />
    </states>
\end{listing}
}

\newpage

{\footnotesize
\begin{listingcont}
    <transitions>
      <transition  source="0"  target="0" >
        <label>
          <leftExtMul>
            <weight>
	      <monElmt>
		<monGen  value = "b" />
	      </monElmt>
            </weight>
            <monElmt>
              <monGen  value = "b" />
            </monElmt>
          </leftExtMul>
        </label>
      </transition>
      <transition  source="0"  target="1" >
        <label>
	  <monElmt>
	    <monGen  value = "a" />
	  </monElmt>
        </label>
      </transition>
      <transition  source="1"  target="1" >
        <label>
          <leftExtMul>
            <weight>
	      <monElmt>
		<monGen  value = "a" />
	      </monElmt>
            </weight>
            <monElmt>
              <monGen  value = "a" />
            </monElmt>
          </leftExtMul>
        </label>
      </transition>
      <transition  source="1"  target="2" >
        <label>
          <monElmt>
            <monGen  value = "b" />
          </monElmt>
        </label>
      </transition>
\end{listingcont}
}

\newpage
\enlargethispage*{2ex}
{\footnotesize
\begin{listingcont}
      <transition  source="2"  target="1" >
        <label>
          <leftExtMul>
            <weight>
	      <monElmt>
		<monGen  value = "a" />
		<monGen  value = "b" />
	      </monElmt>
            </weight>
            <monElmt>
              <monGen  value = "a" />
            </monElmt>
          </leftExtMul>
        </label>
      </transition>
      <transition  source="2"  target="1" >
        <label>
          <leftExtMul>
            <weight>
	      <monElmt>
		<monGen  value = "b" />
		<monGen  value = "a" />
	      </monElmt>
            </weight>
            <monElmt>
              <monGen  value = "b" />
            </monElmt>
          </leftExtMul>
        </label>
      </transition>
      <initial state="0"/>
      <final   state="0"/>
      <final   state="1"/>
	<label>
	  <leftExtMul>
	    <weight>
	      <monElmt>
		<monGen  value = "a" />
	      </monElmt>
	    </weight>
	    <one/>
	  </leftExtMul>
	<label>
      </final>
      <final   state="2"/>
	<label>
	  <leftExtMul>
	    <weight>
	      <monElmt>
		<monGen  value = "a" />
		<monGen  value = "b" />
	      </monElmt>
	    </weight>
	    <one/>
	  </leftExtMul>
	</label>
      </final>
    </transitions>
  </automatonStruct>
</automaton>

</fsmxml>
\end{listingcont}
}

\clearpage
